---
id: m-7752
status: in_progress
deps: []
links: [m-2095]
created: 2026-01-25T06:39:25Z
type: bug
priority: 1
assignee: chriskd
---
# Fix scoped typed-relations handling (indexing/publish/neighbor expansion)

Typed relations have edge-case issues with scoped paths: update_entry_relations reindexes using unscoped relative paths (stale results in multi-KB), publisher drops @project/@user in relation targets, and neighbor expansion doesn't normalize .md/scope like relations_graph.

## Acceptance Criteria

- [ ] update_entry_relations reindexes/deletes with scope-aware paths (adds regression test)\n- [ ] Publisher preserves or explicitly handles scoped relation targets in URLs/output\n- [ ] Neighbor expansion normalizes relation paths consistently with relations_graph (add tests)


## Notes

**2026-01-25T19:54:57Z**

Fixes: update_entry_relations now reindexes/deletes with scoped paths in multi-KB; neighbor expansion normalizes relation/semantic paths with .md + scope consistent with relations_graph; publisher skips scoped relation targets that don't match current KB scope. Added tests for scoped reindexing, neighbor normalization, and publisher scope mismatch.
